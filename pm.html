
<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <title>title</title>
  </head>
  <body>
  <img id="myImg" src="https://www.21co.com/~/media/Images/3 List View Images/21C-MedSpecialties-Thumb-492x320.ashx?mw=430" />

<div id="item">
</div>



<script>
   

    function sendCacthRequest(what, where, to, portName, callback) {
        if (!to)
            throw Error("Argument 'to' is required");

        if (!to.id)
            to.id = 'id' + (new Date()).getTime();

        if (!portName)
            portName = 'port' + (new Date()).getTime();

        // The ID of the extension we want to talk to.
        var extensionId = "bmejefjdpikbdgcgaahoajnndpeakhfk";

        // Start a long-running conversation:
        var port = chrome.runtime.connect(extensionId, { name: portName });

        //start listening for a catch message (One and only one)
        port.onMessage.addListener(function (msg, sendingPort) {
            if (message.data.type == 'catched') {

                //place what was cached into "data-latest-catched-content" of "to" and dispatch CatchedContentReceived event
                var catchInfo = message.data.catchInfo;
                var catchedItem = message.data.catchedItem;
                var host = document.getElementById(catchInfo.to);
                if (host) {
                    host.setAttribute("data-latest-catched-content", JSON.stringify(catchedItem));
                    if (callback)
                        try{
                            callback(catchedItem, catchInfo);
                        }
                        catch (error) {
                            console.log("The callback function for catching threw the error following. The catchInfo was: " + JSON.stringify(catchInfo) + '\r\n' + "The catchedItem was: " + JSON.stringify(catchedItem) + '\r\n' + "The error was: " + error);
                        }
                    var event = new Event('CatchedContentReceived', { detail: {catchedItem : catchedItem, catchInfo : catchInfo} });
                    host.dispatchEvent(event);
                }

                //acknowledge and shut down the port
                port.postMessage({
                    ack: "ok"
                });

                port.disconnect();
            };
        });

        port.postMessage({
            type: "catch",
            catchInfo: {
                what: what,
                where: where,
                to: to.id
            }
        });

    }


     $(document).ready(function () {
        sendCacthRequest("Image", "https://cnn.com", $("#myImg").get(0), null, (catchedItem, catchInfo) => { alert(JSON.stringify(catchedItem)) });
    });
    
</script>




  </body>
</html>
